<!DOCTYPE HTML>
<html>
<head>
	<meta charset="UTF-8">
	<script type="text/javascript" src="js/jquery.js"></script>
	<script type="text/javascript" src="js/highcharts.js"></script>
	

	<script type="text/javascript" src="js/performance.js"></script>
	<script type="text/javascript" src="js/cpu.js"></script>
	<script type="text/javascript" src="js/mem.js"></script>
	<script type="text/javascript" src="js/network.js"></script>
	<style type="text/css">
		#submitBtn{border:1px #046395 solid; background: #0683c7;color: #fff;padding: 3px 10px;}
	</style>
</head>
<body>

<div id="tips" style="display:none">
     <p style="text-align:center;padding-top:100px;color:#666">无法获取性能数据,请检查物理机状态！</p>
</div>
<div id="chart">
    <div style="text-align:center;padding:7px 0">
    	开始时间：<input style="position:relative;top:-4px;" type="datetime-local" onclick="$(this).css('top',0)" id="dateTimePicker" /> <button id="submitBtn">确定</button>
    </div>
    <div id="cpuChart" style="width:100%;height:300px"></div>
	<div id="memChart" style="width:100%;height:300px"></div>
	<div id="networkChart" style="width:100%;height:300px"></div>
</div>

</body>
</html>
<script type="text/javascript">

    $("#submitBtn").bind("click",function(){
                              
        sendTimeToIOS($("#dateTimePicker").val().replace("T"," "));
    })
    var chartMap = new Map();
	
    //刷新图标
	function updateData(Data){
		 drawLineCpu($.PERFORMANCE.formHostJson(Data), "all");
		 drawLineMemory($.PERFORMANCE.formHostJson(Data));
		 drawLineNetWork($.PERFORMANCE.formHostJson(Data),"host");
	}
    //与ios通信
    var _bridge;
	function connectWebViewJavascriptBridge(callback) {
	    if (window.WebViewJavascriptBridge) {
	        callback(WebViewJavascriptBridge)
	    } else {
	        document.addEventListener('WebViewJavascriptBridgeReady', function() {
	            callback(WebViewJavascriptBridge)
	        }, false)
	    }
	}

	connectWebViewJavascriptBridge(function(bridge) {
        
	    bridge.init(function(message, responseCallback) {
       	        if (responseCallback) {
	            responseCallback("Right back atcha")
	        }
	    })

	    bridge.registerHandler('testJavascriptHandler', function(data, responseCallback) {
	    	if(typeof data != "string"){
           		updateData(JSON.stringify(data));
            }else{
                $("#chart").hide();
                $("#tips").show();
            }
			var responseData = { 'Javascript Says':'Right back atcha!' }
			responseCallback(responseData)
		})
        _bridge = bridge;
	    bridge.send('Hello from the javascript')
	    bridge.send('Please respond to this', function responseCallback(responseData) {
	        console.log("Javascript got its response", responseData)
	    })
	})
    
    function sendTimeToIOS(time){
        _bridge.send(time, function responseCallback(responseData) {
            console.log("Javascript got its response", responseData)
        })
    }


</script>